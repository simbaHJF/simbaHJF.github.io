---
layout:     post
title:      "mysql事务"
date:       2019-06-17 13:30:00 +0800
author:     "simba"
header-img: "img/post-bg-miui6.jpg"
tags:
    - mysql

---

> 极客时间--丁奇--mysql实战 学习笔记

##	事务
事务特性:ACID(Atomicity,Consistency,Isolation,Durability)

隔离级别与隔离性:

隔离级别 | 隔离性 |
-|-|
读未提交  |  脏读  |
读已提交  |  不可重复读  |
可重复读  |  幻读  |
串行化  |  -  |


##	事务隔离的实现
在MySQL中,每条记录在更新的时候都会同时记录一条回滚操作.记录上的最新值,通过回滚操作,都可以得到前一个状态的值.
假如一个值从1被按顺序改成了2,3,4,在回滚日志里面就会有类似下面的记录.

![nbXhdA.png](https://s2.ax1x.com/2019/09/19/nbXhdA.png)

当前值是4,但是在查询这条记录的时候,不同时刻启动的事务会有不同的read-view.如图中看到的,在视图A,B,C,这一个记录的值分别是1,2,4,同一条记录在系统中可以存在多个版本,这就是数据库的多版本并发控制(MVCC).对于read-view A,要得到1,就必须将当前值依次执行图中所有的回滚操作得到.

回滚日志不能一直保留,会在不需要的时候删除,系统会判断,当没有事务再需要用到这些回滚日志时,回滚日志会被删除.什么时候才不需要了呢?就是当系统里没有比这个回滚日志更早的read-view的时候