---
layout:     post
title:      "kafka 日志存储"
date:       2021-06-01 12:30:00 +0800
author:     "simba"
header-img: "img/post-bg-miui6.jpg"
tags:
    - MQ

---




## 导航
[一. 文件目录布局](#jump1)
<br>









<br><br>
## <span id="jump1">一. 文件目录布局</span>

<br>
**<font size="4">分区主题日志逻辑结果图</font>** <br>

[![2ncy79.png](https://z3.ax1x.com/2021/06/01/2ncy79.png)](https://imgtu.com/i/2ncy79)

Log对应了一个命名形式为\<topic\>-\<partition\>的文件夹。举个例子，假设有一个名为“topic-log”的主题，此主题中具有 4 个分区，那么在实际物理存储上表现为“topic-log-0”, “topic-log-1”, “topic-log-2”, “topic-log-3” 这4个文件夹. <br>

向Log中追加消息时是顺序写入的,当一个LogSegment写满后,会创建一个新的LogSegment,只有当前最新LogSegment可供写入,其他的LogSegment都只能做读取用.<br>

kafka常用文件:
* .log文件 ----- 对应消息数据日志文件
* .index文件 ----- 偏移量索引文件
* .timeindex ----- 时间戳索引文件

每个 LogSegment 都有一个基准偏移量 baseOffset，用来表示当前 LogSegment 中第一条消息的offset.偏移量是一个64位的长整型数，日志文件和两个索引文件都是根据基准偏移量(baseOffset)命名的，名称固定为20 位数字，没有达到的位数则用 0 填充.  比如第一个 LogSegment 的基准偏移量为 0，对应的日志文件为 00000000000000000000.logo。如某一时刻,topic-log-0目录中的布局如下:

[![2nWaE4.png](https://z3.ax1x.com/2021/06/01/2nWaE4.png)](https://imgtu.com/i/2nWaE4)

这里需要说明一点,每个 LogSegment 中不只包含前面说的三种文件,还可能包含一些其他文件.有关其他文件这里先暂不深入说.<br>


